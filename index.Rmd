---
title: "Climate emergency open data"
output:
  html_document:
    theme: flatly
    css: styles.css
    self_contained: TRUE
    toc: true
    toc_depth: 2
    toc_float: true
    df_print: paged
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(tidyverse) ; library(scales) ; library(ggsci) ; library(sf) ; library(ggrepel) ; library(lubridate) ; library(rvest) ; library(treemapify) ; library(ggiraph)

theme_x <- function () { 
  theme_minimal(base_size = 14, base_family = "Open Sans") %+replace% 
    theme(
      panel.grid.major.x = element_blank(),
      panel.grid.minor = element_blank(),
      plot.title = element_text(size = 16, face = "bold", hjust = 0),
      plot.subtitle = element_text(hjust = 0, margin = margin(9, 0, 9, 0)),
      plot.caption = element_text(size = 12, color = "grey50", hjust = 1, margin = margin(t = 15)),
      axis.title = element_text(size = 10, hjust = 1),
      axis.text.x = element_text(angle = 90, hjust = 1, margin = margin(t = 0)),
      legend.position = "top", 
      legend.justification = "left"
    )
}

la <- st_read(paste0("https://ons-inspire.esriuk.com/arcgis/rest/services/Administrative_Boundaries/Local_Authority_Districts_December_2018_Boundaries_UK_BGC/MapServer/0/query?where=UPPER(lad18nm)%20like%20'%25", URLencode(toupper("Trafford"), reserved = TRUE), "%25'&outFields=lad18cd,lad18nm,long,lat&outSR=4326&f=geojson"), quiet = TRUE) %>% 
  select(area_code = lad18cd, area_name = lad18nm, lon = long, lat)
```

Last updated: September 2019

**As of July 2019, more than half of the UK's councils have declared a 'climate emergency'. This datakit is designed to help councils address this emergency by making open data relating to climate change more discoverable.**

```{r fig.retina = 3}
climate_emergency_councils <- st_read("data/councils/climate_emergency_councils.geojson", quiet = TRUE) %>% 
  mutate(area_name = str_replace_all(area_name, "'", ""),
         tooltip = str_c("<b>", area_name, ": ", status, "</b></span></div>")) 

gg <- ggplot() + 
  geom_sf_interactive(data = climate_emergency_councils,
                      aes(fill = status, 
                          tooltip = tooltip,
                          data_id = area_code),
                      color = "#757575", size = 0.1) +
  labs(x = NULL, y = NULL,
       title = NULL,
       subtitle = NULL,
       caption = "Contains Ordnance Survey data © Crown copyright and database right 2019\nData: climateemergency.uk",
       fill = NULL) +
  scale_fill_manual(values = c("#FFE800", "#13B3E5"), 
                    labels = c("Declared", "Undeclared")) +
  coord_sf(datum = NA) +
  theme_x() +
  theme(plot.caption = element_text(size = 8, hjust = 0),
        legend.position = "right",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 8, family = "Open Sans")) 

gg <- girafe(ggobj = gg)
girafe_options(gg,
               opts_tooltip(use_fill = TRUE),
               opts_hover(css = "stroke-width:1px;"),
               opts_toolbar(saveaspng = FALSE))

```

**A variety of open datasets are presented with metadata and example visualisations. Structured data that has been pre-processed by the <a href="https://www.trafforddatalab.io/" target="_blank">Trafford Data Lab</a> are provided at local authority level where available. In some cases, the <a href="https://cran.r-project.org/" target="_blank">R</a> script used to pre-process the data is given rather than the data.**

***

## Carbon dioxide emissions
Total carbon dioxide emissions are broken down by different domestic, industrial & commercial, and transport sectors. Carbon dioxide emissions are also available per capita (<em>kt</em>CO<sub>2</sub>/capita).

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Carbon dioxide emissions |2005-2017 |Local authority |<a href="https://www.gov.uk/government/collections/uk-local-authority-and-regional-carbon-dioxide-emissions-national-statistics" target="_blank">BEIS</a> | 2019-06-27 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/co2_emissions.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
co2_emissions <- read_csv("data/co2_emissions.csv") %>% 
  filter(area_name == "Trafford",
         group %in% c("Domestic total", "Industry and commercial total", "Transport total"))

ggplot(data = co2_emissions, 
       aes(x = period, y = value, fill = group)) +
  geom_col(position = "stack") +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  scale_y_continuous(labels = comma, expand = c(0.005, 0.005)) +
  scale_fill_viridis_d(direction = -1,
                       labels = c("Domestic total" = "Domestic", 
                                  "Industry and commercial total" = "Industry and commercial", 
                                  "Transport total" = "Transport")) +
  labs(x = NULL, 
       y = expression(paste(italic("kt"), CO[2])),
       title = "Carbon dioxide emissions by main sector",
       subtitle = paste0(distinct(co2_emissions, area_name), ", 2005-2017"),
       caption = "Source: BEIS",
       fill = NULL) +
  guides(fill = guide_legend(reverse = TRUE)) +
  theme_x()
```

**Additional resources**    
The <a href="http://naei.defra.gov.uk/" target="_blank">National Atmospheric Emissions Inventory</a> (NAEI) website has an <a href="https://naei.beis.gov.uk/laco2app" target="_blank">interactive map</a> that allows you to explore CO<sub>2</sub> emissions by local authority area and sector.

***

## Carbon dioxide emissions from large industrial installations
Carbon dioxide emissions from large industrial installations are available across the UK from the <a href="http://naei.defra.gov.uk/" target="_blank">National Atmospheric Emissions Inventory</a>. Other greenhouse gases such as methane and nitrous oxide are also available.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|CO<sub>2</sub> emissions from large industrial installations |2016 |Point locations |<a href="https://naei.beis.gov.uk/data/map-large-source" target="_blank">NAEI</a> | 2018-09-27 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/large_point_sources.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
large_point_sources <- read_csv("data/large_point_sources.csv") %>% 
  mutate(value = round(value,0)) %>% 
  filter(area_name == "Trafford")

ggplot(large_point_sources, aes(lon, lat)) + 
  geom_sf(data = la, fill = NA, color = "#212121", size = 0.5) +
  geom_point(aes(size = value, alpha = value), fill = "#212121", shape = 21) +
  scale_alpha_continuous(guide = "legend", label = comma, breaks = pretty_breaks(5)) +
  scale_size_continuous(label = comma, range = c(2, 12), breaks = pretty_breaks(5)) +
  labs(x = NULL, y = NULL, size = "Tonnes", alpha = "Tonnes",
       title = expression(bold(paste(CO[2], " emissions from large industrial installations"))),
       subtitle = paste0(distinct(large_point_sources, area_name), ", 2016"),
       caption = "Contains Ordnance Survey data © Crown copyright and database right 2019\nSource: NAEI") +
  coord_sf(datum = NA) +
  theme_x() +
  theme(plot.caption = element_text(size = 8, hjust = 0),
        legend.position = "right",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 8)) 
```

***

## Non domestic energy consumption
Estimates of total industrial & commercial energy consumption is available for 2005 to 2016.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Non domestic energy consumption |2016 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/total-final-energy-consumption-at-regional-and-local-authority-level" target="_blank">BEIS</a> | 2019-08-19 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/non_domestic_energy_consumption.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
non_domestic_energy_consumption <- read_csv("data/non_domestic_energy_consumption.csv") %>% 
  filter(area_name == "Trafford") %>% 
  mutate(value = round(value,0)) %>% 
  arrange(value) %>% 
  mutate(group = factor(group, levels = group))

ggplot(non_domestic_energy_consumption, aes(x = value, y = group)) +
  geom_segment(aes(x = 0, xend = value, y = group, yend = group), 
               linetype = "dotted", colour = "#212121", size = 0.5) + 
  geom_point(colour = "#dd1c77", size = 15) +
  geom_text(aes(label = comma(value)), fontface = "bold", size = 4, colour = "white") +
  labs(x = "Gigawatt hours (GWh)", y = NULL, 
       title = "Industrial and commercial fuel use",
       subtitle = paste0(distinct(non_domestic_energy_consumption, area_name), ", 2016"),
       caption = "Source: BEIS",
       fill = NULL) +
  theme_x() +
  theme(aspect.ratio = 0.5,
        panel.grid.major = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(hjust = 0))
```

***

## Road transport fuel consumption
Estimates of road transport fuel use by local authority are available for petrol (petrol cars, motorcycles and petrol LGVs) and diesel (diesel cars, diesel LGVs, HGVs and buses) consuming vehicles. Estimates by road type (motorways, A roads and minor roads) is also available in the source dataset.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Road transport energy consumption |2005-2017 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/road-transport-energy-consumption-at-regional-and-local-authority-level" target="_blank">BEIS</a> | 2019-06-27 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/road_transport_energy_consumption.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
road_transport_fuel_consumption <- read_csv("data/road_transport_fuel_consumption.csv") %>% 
  filter(area_name == "Trafford")

ggplot(road_transport_fuel_consumption, 
       aes(x = period, y = value)) +
  geom_line(colour = "#88CCEE", size = 0.8) +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  scale_y_continuous(labels = comma,
                     expand = c(0.005, 0.005)) +
  labs(x = NULL, 
       y = "tonnes of oil",
       title = "Fuel use by vehicle type",
       subtitle = paste0(distinct(road_transport_fuel_consumption, area_name), ", 2005-2017"),
       caption = "Source: BEIS",
       colour = NULL) +
  facet_wrap(~group, nrow = 1) +
  theme_x() + 
  theme(axis.text.x = element_text(vjust = 1),
        strip.text.x = element_text(size = 9, hjust = 0),
        legend.position = "none") 
```

***

## Domestic energy consumption
Estimates of total domestic energy consumption is available for 2005 to 2016.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Domestic energy consumption |2016 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/total-final-energy-consumption-at-regional-and-local-authority-level" target="_blank">BEIS</a> | 2019-08-19 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/domestic_energy_consumption.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
domestic_energy_consumption <- read_csv("data/domestic_energy_consumption.csv") %>% 
  filter(area_name == "Trafford") %>% 
  mutate(value = round(value,0)) %>% 
  arrange(value) %>% 
  mutate(group = factor(group, levels = group))

ggplot(domestic_energy_consumption, aes(x = value, y = group)) +
  geom_segment(aes(x = 0, xend = value, y = group, yend = group), 
               linetype = "dotted", colour = "#212121", size = 0.5) + 
  geom_point(colour = "#DDCC77", size = 15) +
  geom_text(aes(label = comma(value)), fontface = "bold", size = 4, colour = "white") +
  labs(x = "Gigawatt hours (GWh)", y = NULL, 
       title = "Domestic fuel use",
       subtitle = paste0(distinct(domestic_energy_consumption, area_name), ", 2016"),
       caption = "Source: BEIS",
       fill = NULL) +
  theme_x() +
  theme(aspect.ratio = 0.5,
        panel.grid.major = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(hjust = 0))
```

***

## Domestic property build period
Information about the age of domestic dwellings is available from the <a href="https://www.gov.uk/government/organisations/valuation-office-agency" target="_blank">Valuation Office Agency</a>. The age of a building influences energy consumption with older properties tending to be less energy efficient than newer buildings.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Domestic property build period |pre-1900 to 2018 |Local authority |<a href="https://www.gov.uk/government/statistics/council-tax-stock-of-properties-2018" target="_blank">VOA</a> | 2018-11-29 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/domestic_property_build_period.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
domestic_property_build_period <- read_csv("data/domestic_property_build_period.csv") %>% 
  filter(area_name == "Trafford") %>% 
  mutate(group = as.factor(group),
         group = fct_relevel(group, "pre-1900"))

ggplot(domestic_property_build_period, 
         aes(x = factor(group), y = value)) +
  geom_col(fill = "brown4") +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  scale_y_continuous(labels = comma) +
  labs(x = NULL, 
       y = "Dwellings",
       title = "Build period of domestic dwellings",
       subtitle = paste0(distinct(domestic_property_build_period, area_name), ", 2018"),
       caption = "Source: Valuation Office Agency")  +
  theme_x()
```

***

## EPCs by Environmental Impact Rating 
An Energy Performance Certificates' (EPC) Environmental Impact Rating is an estimate of the amount of CO<sub>2</sub> produced by a home. The most energy efficient homes fall within band A (lowest CO<sub>2</sub> emissions) and the least efficent in Band G (highest CO<sub>2</sub> emissions). Lodgements on the Energy Performance of Buildings Register are published on a quarterly basis.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|EPCs by Environmental Impact Rating |2009-2018 |Local authority |<a href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/821971/D2_-_Domestic_EPCs.xlsx" target="_blank">MHCLG</a> | 2019-07-31 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/domestic_epcs.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
domestic_epcs <- read_csv("data/domestic_epcs.csv") %>% 
  filter(area_name == "Trafford") %>% 
  group_by(area_name, group) %>% 
  summarise(value = sum(value)) %>% 
  mutate(value = value / sum(value))

ggplot(domestic_epcs, aes(x = fct_rev(factor(group)), y = value)) +
  geom_col(fill = "#bcbddc") +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  geom_text(aes(x = group, y = value, label = percent(value)),
            colour = "#212121", size = 5, hjust = -0.1) +
  scale_y_continuous(expand = c(0.005, 0.005), limit = c(0, 0.4)) +
  labs(x = NULL, y = NULL,
       title = "Cumulative domestic EPCs by Environmental Impact Rating",
       subtitle = paste0(distinct(domestic_epcs, area_name), ", 2009-2018"),
       caption = "Source: MHCLG") +
  coord_flip() +
  theme_x() +
  theme(panel.grid.major = element_blank(),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 14, face = "bold"))
```

***

## Flood risk
The chance of flooding from rivers and/or the sea is available at 50m by 50m resolution. Each grid cell is allocated to one of four flood risk categories, taking into account flood defences and their condition. The risk of flooding from surface water is available from <a href="https://data.gov.uk/dataset/d5ca01ec-e535-4d3f-adc0-089b4f03687d/risk-of-flooding-from-surface-water-suitability" target="_blank">here</a>.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Code |
|---|---|---|---|---|---|---|
|Flood risk |2019-05-30 (quarterly updates) |UK |<a href="https://data.gov.uk/dataset/risk-of-flooding-from-rivers-and-sea1" target="_blank">Environment Agency</a> | 2019-06-12 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="code/flood_risk.R" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
flood_risk <- st_read("data/flood_risk.geojson", quiet = TRUE)

ggplot() + 
  geom_sf(data = la, fill = "#E7E7E7", alpha = 1, colour = "NA") +
  geom_sf(data = flood_risk, aes(fill = prob_4band), colour = "NA") +
  scale_fill_manual(values = c("#eff3ff", "#bdd7e7", "#6baed6", "#2171b5"), 
                    labels = c("Very Low", "Low", "Medium", "High")) +
  labs(x = NULL, y = NULL,
       title = "Risk of Flooding from Rivers and Sea",
       subtitle = "Trafford, 2019-05-30",
       caption = "Contains Ordnance Survey data © Crown copyright and database right 2019\nSource: Environment Agency",
       fill = NULL) +
  guides(fill = guide_legend(reverse = TRUE)) +
  coord_sf(datum = NA) +
  theme_x() +
  theme(plot.caption = element_text(size = 8, hjust = 0),
        legend.position = "right",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 8)) 
```

**Additional resources**    
The <a href="https://www.gov.uk/government/organisations/environment-agency" target="_blank">Environment Agency</a> has an <a href="https://flood-warning-information.service.gov.uk/long-term-flood-risk/map" target="_blank">interactive map</a> showing flood risk information.

***

## Air Quality Management Areas
<a href="https://uk-air.defra.gov.uk/aqma/" target="_blank">Air Quality Management Areas</a> (AQMA) are declared when a local authority expects that air quality will not meet the <a href="https://uk-air.defra.gov.uk/assets/documents/National_air_quality_objectives.pdf" target="_blank">National Air Quality Objectives</a>.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Code |
|---|---|---|---|---|---|---|
|Air Quality Management Areas |2019-07 |UK |<a href="https://uk-air.defra.gov.uk/aqma/maps" target="_blank">DEFRA</a> |2019-07 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="code/aqma.R" target="_blank">view</a> |
</div>

```{r}
aqma <- st_read("data/aqma.geojson", quiet = TRUE)

ggplot() + 
  geom_sf(data = la, fill = "#E7E7E7", alpha = 1, colour = "NA") +
  geom_sf(data = aqma, aes(fill = prob_4band), fill = "#727C81", colour = "NA") +
  labs(x = NULL, y = NULL,
       title = "Air Quality Management Area",
       subtitle = "Trafford, 2019",
       caption = "Contains Ordnance Survey data © Crown copyright and database right 2019\nSource: DEFRA") +
  guides(fill = guide_legend(reverse = TRUE)) +
  coord_sf(datum = NA) +
  theme_x() +
  theme(plot.caption = element_text(size = 8, hjust = 0),
        legend.position = "right",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 8)) 
```

**Additional resources**    
<a href="https://www.gov.uk/government/organisations/department-for-environment-food-rural-affairs" target="_blank">DEFRA</a> has an <a href="https://uk-air.defra.gov.uk/aqma/maps" target="_blank">AQMAs interactive map</a>.

***

## Background air pollution
Estimates for annual mean background concentrations of nitrogen oxide (NOx), nitrogen dioxide (NO<sub>2</sub>), coarse (PM<sub>10</sub>) and fine particulate matter (PM<sub>2.5</sub>) are available at 1km x 1km resolution. 

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Code |
|---|---|---|---|---|---|---|
|Background air pollution |2017 |1 km x 1 km grid square centroids |<a href="https://uk-air.defra.gov.uk/data/laqm-background-maps?year=2017" target="_blank">DEFRA</a> | 2018-09-27 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="code/background_air_pollution.R" target="_blank">view</a>  |
</div>

```{r fig.retina = 3}
background_air_pollution <- st_read("data/background_air_pollution.geojson", quiet = TRUE)

ggplot(data = background_air_pollution, 
       aes(fill = value, color = value)) +
  geom_sf(data = la, fill = NA, color = "#212121", size = 0.5) +
  geom_sf(color = NA, alpha = 0.8) +
  scale_fill_viridis_c(option = "magma", direction = -1,
                       guide = guide_colorbar(
                         barheight = unit(2, units = "mm"),
                         barwidth = unit(50, units = "mm"),
                         title.position = "left",
                         title.vjust = 1,
                         label.hjust = 0.5
                       )) +
  labs(title = expression(bold(paste("Modelled background ", PM[2.5], " concentrations"))),
       subtitle = "Trafford, 2017",
       caption = "Contains Ordnance Survey data © Crown copyright and database right 2019\nSource: DEFRA",
       fill = "Annual mean (μg/m3)") +
  coord_sf(datum = NA) +
  theme_x() +
  theme(plot.caption = element_text(size = 8, hjust = 0),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 8)) 
```

**Additional resources**    
The <a href="https://uk-air.defra.gov.uk/data/gis-mapping" target="_blank">UK Ambient Air Quality Interactive Map</a> visualises the background concentration data.

***

## Roadside air pollution
There are several sources of continuous air quality monitoring data including: <a href="https://uk-air.defra.gov.uk/data/" target="_blank">DEFRA UK-AIR</a>; <a href="https://www.airqualityengland.co.uk/" target="_blank">Air Quality England</a>; <a href="http://www.scottishairquality.scot/" target="_blank">Air Quality in Scotland</a>; <a href="https://airquality.gov.wales/" target="_blank">Air Quality in Wales</a>; <a href="https://www.airqualityni.co.uk/" target="_blank">Northern Ireland Air</a> and <a href="https://openaq.org/#/locations?countries=GB" target="_blank">OpenAQ</a>. The legal limits for NO<sub>2</sub>, PM<sub>10</sub> and PM<sub>2.5</sub> concentrations are available <a href="https://ec.europa.eu/environment/air/quality/standards.htm" target="_blank">here</a>.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Code |
|---|---|---|---|---|---|---|
|Roadside air pollution |Continuous |Monitoring station |<a href="https://www.airqualityengland.co.uk/" target="_blank">Ricardo Energy & Environment</a> | 2018-09-27 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="code/roadside_air_pollution.R" target="_blank">view</a> |
</div>
 
```{r fig.retina = 3}
roadside_air_pollution <- read_csv("data/roadside_air_pollution.csv")

ggplot(roadside_air_pollution, aes(x = date_hour, y = value)) +
  geom_line(colour = "#CC6677", size = 0.3) +
  geom_hline(aes(yintercept = 200), linetype = "dotted", color = "#000000", size = 0.8) +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  scale_x_datetime(breaks = roadside_air_pollution$date_hour, date_labels = "%b-%y", date_breaks = "3 months") +
  scale_y_continuous(limits = c(0, 220), expand = c(0.005, 0.005)) +
  labs(title = expression(bold(paste("1-hour mean ", NO[2], " concentrations"))),
       subtitle = "Trafford A56 monitoring station, last 12 months",
       caption = "Source: Trafford Council / Ricardo EE",
       x = "",
       y = expression(paste("μg/m"^3))) +
  theme_x()
```

***

## Renewable electricity generation 
Data on renewable electricity installations, their capacity (MW) and generation (MWh) are available at a local authority level.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Renewable electricity generation |2014-2017 |Local authority |<a href="https://www.gov.uk/government/statistics/regional-renewable-statistics" target="_blank">BEIS</a> | 2018-09-27 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/renewable_electricity_generation.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
renewable_electricity_generation <- read_csv("data/renewable_electricity_generation.csv") %>% 
  filter(area_name == "Trafford", value != 0)

ggplot(renewable_electricity_generation, 
       aes(area = value, fill = fct_reorder(group, value, .desc = TRUE), subgroup = group, label = group)) +
  geom_treemap(colour = "#212121") +
  geom_treemap_text(colour = "#FFFFFF", place = "bottomleft", reflow = TRUE, 
                    padding.x = grid::unit(1.5, "mm"),
                    padding.y = grid::unit(2, "mm"),
                    size = 14) +
  scale_fill_simpsons() +
  labs(x = NULL, y = NULL, 
       title = "Renewable electricity generation by source",
       subtitle = paste0(distinct(renewable_electricity_generation, area_name), ", 2017"),
       caption = "Source: BEIS",
       fill = NULL) +
  theme_x() +
  theme(legend.position = "right")
```

***

## Recycling
The percentage of household waste sent for reuse, recycling or composting by local councils is available by financial year.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Recycling |2010/11 - 2017/18 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/env18-local-authority-collected-waste-annual-results-tables" target="_blank">DEFRA</a> | 2018-12-18 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/recycling.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
recycling <- read_csv("data/recycling.csv") %>% 
  filter(area_name == "Trafford")

ggplot(recycling, aes(x = period, y = value, group = 1)) +
  geom_line(colour = "#117733", size = 1) +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  scale_y_continuous(position = "right", labels = percent_format(accuracy = 1)) +
  labs(x = NULL, y = NULL,
       title = "Reuse, recycling or composting of household waste",
       subtitle = paste0(distinct(recycling, area_name), ", 2010/11 - 2017/18"),
       caption = "Source: DEFRA") +
  theme_x()
```

*** 

## Licensed electric vehicles
The number of licensed electric vehicles (battery electric, plug-in hybrid electric, or range-extended electric) registered by the keeper's local authority is published by the Department for Transport. Data on licensed diesel and ultra low emission vehicles (ULEVs) is also available in the source data.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Licensed electric vehicles |2011-10-01 - 2019-04-01 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/all-vehicles-veh01" target="_blank">Department for Transport </a> | 2019-09-12 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/electric_vehicles.csv" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
electric_vehicles <- read_csv("data/electric_vehicles.csv") %>% 
  filter(area_name == "Trafford")

ggplot(electric_vehicles, aes(x = period, y = value)) +
  geom_line(colour = "#332288", size = 1.5) +
  geom_hline(yintercept = 0, size = 1, colour = "#212121") +
  scale_y_continuous(position = "right", limits = c(0, NA), labels = comma) +
  labs(x = NULL, y = "Count", 
       title = "Number of licensed electric vehicles",
       subtitle = paste0(distinct(electric_vehicles, area_name), ", 2011 Q4 - 2019 Q2"),
       caption = "Data: DfT and DVLA") +
  theme_x() +
  theme(axis.title.y = element_text(hjust = 0))
```

***

## Cycling
Local authority cycling rates are published by the Department of Transport from the <a href="https://www.sportengland.org/research/active-lives-survey/" target="_blank">Active Lives Survey</a>.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Cycling |2017-11 - 2018-11 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/walking-and-cycling-statistics-cw" target="_blank">Department for Transport</a> | 2019-07-31 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/cycling.csv" target="_blank">view</a> |
</div>

The <a href="https://www.sportengland.org/research/active-lives-survey/" target="_blank">Active Lives Survey</a> estimate that in 2017/18:

- `r round(pull(filter(read_csv("data/cycling.csv"),area_name == "Trafford", group == "Five times per week"), value), 1)`% of Trafford residents cycle five times a week
- `r round(pull(filter(read_csv("data/cycling.csv"),area_name == "Trafford", group == "Three times per week"), value), 1)`% of Trafford residents cycle at least three times a week
- `r round(pull(filter(read_csv("data/cycling.csv"),area_name == "Trafford", group == "Once per week"), value), 1)`% of Trafford residents cycle at least once a week
- `r round(pull(filter(read_csv("data/cycling.csv"),area_name == "Trafford", group == "Once per month"), value), 1)`% of Trafford residents cycle at least once per month

***

## Walking

Local authority walking rates are published by the Department of Transport from the <a href="https://www.sportengland.org/research/active-lives-survey/" target="_blank">Active Lives Survey</a>.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Data |
|---|---|---|---|---|---|---|
|Walking |2017-11 - 2018-11 |Local authority |<a href="https://www.gov.uk/government/statistical-data-sets/walking-and-cycling-statistics-cw" target="_blank">Department for Transport</a> | 2019-07-31 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="data/walking.csv" target="_blank">view</a> |
</div>

The <a href="https://www.sportengland.org/research/active-lives-survey/" target="_blank">Active Lives Survey</a> estimate that in 2017/18:

- `r round(pull(filter(read_csv("data/walking.csv"),area_name == "Trafford", group == "Five times per week"), value), 1)`% of Trafford residents walk five times a week
- `r round(pull(filter(read_csv("data/walking.csv"),area_name == "Trafford", group == "Three times per week"), value), 1)`% of Trafford residents walk at least three times a week
- `r round(pull(filter(read_csv("data/walking.csv"),area_name == "Trafford", group == "Once per week"), value), 1)`% of Trafford residents walk at least once a week
- `r round(pull(filter(read_csv("data/walking.csv"),area_name == "Trafford", group == "Once per month"), value), 1)`% of Trafford residents walk at least once per month

***

## Green spaces
Parks, playing fields, gardens and other green spaces that are likely to be publicly accessible are available in the <a href="https://www.ordnancesurvey.co.uk" target="_blank">Ordnance Survey's</a> OS Open Greenspace product.

<div class = "metadata">
|Indicator |Period |Geography |Source |Updated |Licence |Code |
|---|---|---|---|---|---|---|
|Green spaces |2019-04  |Great Britain |<a href="https://www.ordnancesurvey.co.uk/business-and-government/products/os-open-greenspace.html" target="_blank">Ordnance Survey</a> |2019-0 |<a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">OGL v3.0</a> |<a href="code/greenspaces.R" target="_blank">view</a> |
</div>

```{r fig.retina = 3}
greenspaces <- st_read("data/greenspaces.geojson", quiet = TRUE)

ggplot() + 
  geom_sf(data = la, fill = "#E7E7E7", alpha = 1, colour = "NA") +
  geom_sf(data = greenspaces, aes(fill = site_type), colour = "NA") +
  scale_fill_manual(values = c("#66c2a5", "#fc8d62", "#8da0cb", "#e78ac3", "#a6d854", "#ffd92f", "#e5c494"), 
                    labels = c("Allotments Or Community Growing Spaces",
                               "Golf Course", "Play Space", "Playing Field",
                               "Public Park Or Garden", 
                               "Religious Ground and Cemeteries", "Sports")) +
  labs(x = NULL, y = NULL,
       title = "Green spaces",
       subtitle = "Trafford, 2019",
       caption = "Contains Ordnance Survey data © Crown copyright and database right 2019",
       fill = NULL) +
  coord_sf(datum = NA) +
  theme_x() +
  theme(plot.caption = element_text(size = 8),
        legend.position = "right",
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 8)) 
```

**Additional resources**    
The <a href="http://naei.defra.gov.uk/" target="_blank">Ordnance Survey's</a> <a href="https://osmaps.ordnancesurvey.co.uk" target="_blank">interactive OS Maps tool</a> allows you to explore green spaces in the UK interactively.


<br /><br /><br /><br />
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />
<div><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">All content</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>. <a href="https://github.com/traffordDataLab/climate_emergency" target="_blank">
<i class="fa fa-github" style="font-size:24px; float:right; margin-top: -3px;"></i>
</a></div>